<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Backbone EZBindings Examples</title>
    <style type="text/css">
        body{
            padding: 10px 60px;
            font-size: 18px;
            background-color: #efefef;
        }

        .view {
            display: inline-block;
            vertical-align: top;
            margin-right: 100px;
        }

        .field, ul > li{
            margin-bottom: 10px;
        }

        label{
            display: inline-block;
            vertical-align: middle;
            width: 100px;
            text-align: right;
            margin-right: 10px;
        }

        input, select{
            display: inline-block;
            vertical-align: middle;
            width: 200px;
            padding: 5px;
        }

        input.error{
           border: solid 2px red;
           outline-color:red;
        }

        .field > .enabled{
            width: auto;
        }

    </style>

    <script src="../lib/jquery-1.10.2.min.js"></script>
    <script src="../lib/underscore.js"></script>
    <script src="../lib/backbone.js"></script>
    <script src="../backbone.ezbinding.js"></script>

    <script type="text/javascript">

        function validateEmail(email) {
            var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return re.test(email);
        }

        function validateURL(url) {
            var re = new RegExp("^(http|https|ftp)\://([a-zA-Z0-9\.\-]+(\:[a-zA-Z0-9\.&amp;%\$\-]+)*@)*((25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9])\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])|([a-zA-Z0-9\-]+\.)*[a-zA-Z0-9\-]+\.(com|edu|gov|int|mil|net|org|biz|arpa|info|name|pro|aero|coop|museum|[a-zA-Z]{2}))(\:[0-9]+)*(/($|[a-zA-Z0-9\.\,\?\'\\\+&amp;%\$#\=~_\-]+))*$");
            return re.test(url);
        }

        $(document).ready(function(){

            var ModelView = Backbone.View.extend({
                el : '#modelView',

                modelBindings : {
                    //One way bindings
                    '.full-name' : '{firstName} {lastName}',
                    'a.email' : '{email}',
                    '[href] a.email' : 'mailto:{email}',
                    'span.job' : '{job}',
                    '[visible] #user' : '{enabled}',

                    //Two way bindings
                    '[keyup@value] input.first-name' : '{firstName}',
                    '[keyup@value] input.last-name' : '{lastName}',
                    '[@value] input.email' : '{email}',
                    '[@value] select.job' : '{job}',
                    '[@checked] input.enabled' : '{enabled}'
                },

                events : {
                   'change input.email' : 'onEmailChange'
                },

                onEmailChange: function(evt) {
                   var input =  $(evt.target);
                   //If not a valid email, stop the event propagation to prevent binding
                   if (!validateEmail(input.val())){
                       input.addClass('error');
                       evt.stopImmediatePropagation();
                   }else{
                       input.removeClass('error');
                   }
                }

            });

            new ModelView({
                model :new Backbone.Model({
                    firstName : "Joe",
                    lastName : "Smith",
                    job : 'Programmer',
                    email : "joe.smith@inter.net",
                    enabled : true
                })
            }).render();


            var CollectionView = Backbone.View.extend({
                el : '#collectionView',

                modelBindings : {
                    //Specific Model Bindings
                    '[href] a#first-link' : '[0]{url}',
                    '[href] a#aristobot-link' : '[aristobot]{url}',

                    //Recursive One way Model Bindings
                    'ul.links > li' : {
                        '[data-id]' : '{id}',
                        'a.link' : '{url}',
                        '[href] a.link' : '{url}'
                    },

                    //Recursive Two way Model Bindings
                    'ul.edit-links > li' : {
                        '[data-id]' : '{id}',
                        '[disabled] input.link' : '!{editable}',
                        '[@value] input.link' : '{url}'
                    }
                },

                events : {
                     'change input.link' : 'onURLChange',
                     'click #shuffle' : 'onShuffleClick'
                },

                onURLChange: function(evt) {
                    var input =  $(evt.target);
                    //If not a valid url, stop the event propagation to prevent binding
                    if (!validateURL(input.val())){
                        input.addClass('error');
                        evt.stopImmediatePropagation();
                    }else{
                        input.removeClass('error');
                    }
                },

                onShuffleClick : function(){
                    //Shuffle the models then reattach the bindings
                    this.collection.models = _.shuffle(this.collection.models);
                    this.attachBindings();

                    this.$('.link').removeClass("error");
                }
            });

            new CollectionView({
                collection : new Backbone.Collection([
                    {id : 'google', url : 'http://google.com', editable : true},
                    {id : 'aristobot', url : 'http://aristobotgames.com', editable : false},
                    {id : 'wikipedia', url : 'http://wikipedia.com', editable : true},
                    {id : 'github', url : 'https://github.com', editable : true}
                ])
            }).render();
        });

    </script>

</head>

<body>
    <h2>Backbone EZBindings Examples</h2>
    <div id="modelView" class="view">

        <h3>Model Binding</h3>

        <p id="user">
            <strong class="full-name"></strong>&nbsp
            <span class="job"></span>&nbsp
            <a class="email"></a>
        </p>

        <div id="user-edit">

            <div class="field">
                <label>First Name: </label>
                <input class="first-name" type="text"/>
            </div>

            <div class="field">
                <label>Last Name: </label>
                <input class="last-name" type="text"/>
            </div>

            <div class="field">
                <label>Job Title: </label>
                <select class="job">
                    <option value="Programmer">Programmer</option>
                    <option value="Designer">Designer</option>
                    <option value="Manager">Manager</option>
                </select>
            </div>

            <div class="field">
                <label>Email: </label>
                <input class="email" type="text"/>
            </div>

            <div class="field">
                <label>Enabled: </label>
                <input class="enabled" type="checkbox"/>
            </div>
        </div>

    </div>

    <div id="collectionView" class="view">

        <h3>Collection Binding</h3>

        <p>
            <a id="first-link">Link 1</a> &nbsp
            <a id="aristobot-link">Aristobot Games</a>
        </p>

        <ul class="links">
            <li><a class="link"></a></li>
            <li><a class="link"></a></li>
            <li><a class="link"></a></li>
            <li><a class="link"></a></li>
        </ul>

        <ul class="edit-links">
            <li><input type="text" class="link"/></li>
            <li><input type="text" class="link"/></li>
            <li><input type="text" class="link"/></li>
            <li><input type="text"  class="link"/></li>
        </ul>

        <button id="shuffle">Shuffle</button>
    </div>

</body>